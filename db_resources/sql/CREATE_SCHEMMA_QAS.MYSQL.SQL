-- ============================= CREACION DEL ESQUEMA DE LA BASE DE DATOS ====================
-- SCHEMMA COMPATIBLE WITH  MySQL SERVER 5.7.x+
DROP DATABASE IF EXISTS l30_v11_qas;
CREATE DATABASE l30_v11_qas;
USE l30_v11_qas;
-- ============================= TABLES (18) =======================
CREATE TABLE ESTADO (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    DESCRIPCION VARCHAR  (64)  NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE CLIENTE (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    RFC VARCHAR  (16)  NOT NULL,
    RAZON_SOCIAL VARCHAR  (255)  NOT NULL,
    NOMBRE_ESTABLECIMIENTO VARCHAR  (255)  NOT NULL,
    DIRECCION_FACTURACION VARCHAR  (255)  NOT NULL,
    TELEFONOS VARCHAR  (64) ,
    BANCO VARCHAR  (128) ,
    NUM_CUENTA VARCHAR  (32) ,
    EMAIL VARCHAR  (128) ,
    REFERENCIA VARCHAR  (255) ,
    CONTACTO VARCHAR  (64) ,
    UBICACION_LAT DOUBLE  ,
    UBICACION_LON DOUBLE  ,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE PRODUCTO (
    CODIGO_BARRAS VARCHAR  (128)  NOT NULL,
    CODIGO_SHCP VARCHAR  (128)  NOT NULL,
    NOMBRE VARCHAR  (255)  NOT NULL,
    INDUSTRIA VARCHAR  (255)  NOT NULL,
    MARCA VARCHAR  (255)  NOT NULL,
    LINEA VARCHAR  (255)  NOT NULL,
    PRESENTACION VARCHAR  (128)  NOT NULL,
    ABREBIATURA VARCHAR  (32)  NOT NULL,
    UNIDADES_X_CAJA INTEGER  (5)  NOT NULL,
    CONTENIDO VARCHAR  (16)  NOT NULL,
    UNIDAD_MEDIDA VARCHAR  (8)  NOT NULL,
    UNIDAD_EMPAQUE VARCHAR  (10)  NOT NULL,
    COSTO DOUBLE   NOT NULL,
    COSTO_VENTA DOUBLE  ,
    HABILITADO INTEGER  (1)  NOT NULL,
    POCO INTEGER  (4) ,
    PRIMARY KEY (CODIGO_BARRAS)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE SUCURSAL (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    TIPO INTEGER  (2)  NOT NULL,
    CLAVE VARCHAR  (8)  NOT NULL,
    NOMBRE VARCHAR  (128) ,
    DIRECCION VARCHAR  (255) ,
    TELEFONOS VARCHAR  (128) ,
    DESCUENTO_MYOREO_HABILITADO INTEGER  (1)  NOT NULL,
    VENTA_REG_HABILITADO INTEGER  (1)  NOT NULL,
    VENTA_OPO INTEGER  (1)  NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE METODO_DE_PAGO (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    DESCRIPCION VARCHAR  (64)  NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE PROMOCION (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    NOMBRE VARCHAR  (64)  NOT NULL,
    REGLA_ARITMETICA VARCHAR  (255)  NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE FORMA_DE_PAGO (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    DESCRIPCION VARCHAR  (64)  NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE USUARIO (
    ID INTEGER  (5)  NOT NULL,
    EMAIL VARCHAR  (128) ,
    PASSWORD VARCHAR  (128)  NOT NULL,
    TELEFONOS VARCHAR  (64) ,
    HABILITADO INTEGER  (1)  NOT NULL,
    NOMBRE VARCHAR  (64)  NOT NULL,
    APELLIDO_PATERNO VARCHAR  (64) ,
    APELLIDO_MATERNO VARCHAR  (64) ,
    FECHA_REGISTRO TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FECHA_ULT__CAMBIO TIMESTAMP   NULL DEFAULT NULL,
    SUCURSAL_ID INTEGER  (10)  NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE CONFIGURACION_PROOVEDOR_CFD (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    SUCURSAL_ID INTEGER  (10)  NOT NULL,
    PRIORIDAD INTEGER  (1)  NOT NULL,
    PROVEEDOR_CFD VARCHAR  (128)  NOT NULL,
    USUARIO_CFD VARCHAR  (64)  NOT NULL,
    PASSWORD_CFD VARCHAR  (64)  NOT NULL,
    SERIE_CFD VARCHAR  (4)  NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE MOVIMIENTO_OPERATIVO (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    MOTIVO VARCHAR  (128) ,
    FECHA TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
    SUCURSAL_ID_ORIGEN INTEGER  (10)  NOT NULL,
    ALMACEN_ORIGEN VARCHAR  (1)  NOT NULL,
    SUCURSAL_ID_DESTINO INTEGER  (10)  NOT NULL,
    ALMACEN_DESTINO VARCHAR  (1)  NOT NULL,
    TIPO_MOV INTEGER  (2)  NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE PRODUCTO_SUCURSAL (
    PRODUCTO_CODIGO_BARRAS VARCHAR  (128)  NOT NULL,
    SUCURSAL_ID INTEGER  (10)  NOT NULL,
    CANTIDAD_1RA INTEGER  (10)  NOT NULL,
    PRECIO_1RA DOUBLE   NOT NULL,
    CANTIDAD_OPO INTEGER  (10)  NOT NULL,
    PRECIO_OPO DOUBLE   NOT NULL,
    CANTIDAD_REG INTEGER  (10)  NOT NULL,
    PRECIO_REG DOUBLE   NOT NULL,
    PRIMARY KEY (PRODUCTO_CODIGO_BARRAS, SUCURSAL_ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE OFERTA_PRODUCTO (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    PRODUCTO_CODIGO_BARRAS VARCHAR  (128)  NOT NULL,
    SUCURSAL_ID INTEGER  (10)  NOT NULL,
    PROMOCION_ID INTEGER  (10)  NOT NULL,
    FECHA_INICIAL DATE   NOT NULL,
    FECHA_FINAL DATE   NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE USUARIO_PERFIL (
    USUARIO_ID INTEGER  (5)  NOT NULL,
    PERFIL VARCHAR  (16)  NOT NULL,
    PRIMARY KEY (USUARIO_ID, PERFIL)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE ENTRADA_SALIDA_DETALLE (
    ENTRADA_SALIDA_ID INTEGER  (10)  NOT NULL,
    PRODUCTO_CODIGO_BARRAS VARCHAR  (128)  NOT NULL,
    PRIMARY KEY (ENTRADA_SALIDA_ID, PRODUCTO_CODIGO_BARRAS)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE CORTE_CAJA (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    SUCURSAL_ID INTEGER  (10)  NOT NULL,
    TIPO_EVENTO INTEGER  (1)  NOT NULL,
    USUARIO_ID INTEGER  (5)  NOT NULL,
    FECHA TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FECHA_UAP TIMESTAMP   NULL DEFAULT NULL,
    SALDO_INICIAL DOUBLE  ,
    SALDO_FINAL DOUBLE  ,
    USUARIO_ID_AUTORIZO INTEGER  (5)  NOT NULL,
    COMENTARIOS VARCHAR  (255) ,
    CAJA INTEGER  (2)  NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE ENTRADA_SALIDA (
    ID INTEGER  (10)  NOT NULL,
    TIPO_MOV INTEGER  (2)  NOT NULL,
    FECHA_CREO TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
    ESTADO_ID_ACTUAL INTEGER  (10)  NOT NULL,
    CLIENTE_ID INTEGER  (10)  NOT NULL,
    FORMA_DE_PAGO_ID INTEGER  (10)  NOT NULL,
    METODO_DE_PAGO_ID INTEGER  (10)  NOT NULL,
    USUARIO_ID_CREO INTEGER  (5)  NOT NULL,
    USUARIOID INTEGER  (5)  NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE CFD (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    CFD_ID_ORIGEN INTEGER  (10) ,
    ENTRADA_SALIDA_ID INTEGER  (10)  NOT NULL,
    TIPO VARCHAR  (8)  NOT NULL,
    NUM_CFD VARCHAR  (128)  NOT NULL,
    ULTIMO_ERROR VARCHAR  (1024) ,
    CONTENIDO_ORIGINAL MEDIUMBLOB  ,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE ENTRDA_SALIDA_ESTADO (
    ID INTEGER  (10)  NOT NULL AUTO_INCREMENT,
    ENTRADA_SALIDA_ID INTEGER  (10)  NOT NULL,
    FECHA INTEGER  (10) ,
    COMENTARIOS VARCHAR  (255) ,
    ESTADO_ID INTEGER  (10)  NOT NULL,
    USUARIO_ID INTEGER  (5)  NOT NULL,
    PRIMARY KEY (ID)
)ENGINE=InnoDB;

-- ===============================================================================
-- =================================== CONSTRAINTS ==============================
ALTER TABLE USUARIO ADD CONSTRAINT FOREIGN KEY (SUCURSAL_ID)    REFERENCES SUCURSAL(ID);
ALTER TABLE CONFIGURACION_PROOVEDOR_CFD ADD CONSTRAINT FOREIGN KEY (SUCURSAL_ID)    REFERENCES SUCURSAL(ID);
ALTER TABLE MOVIMIENTO_OPERATIVO ADD CONSTRAINT FOREIGN KEY (SUCURSAL_ID_ORIGEN)    REFERENCES SUCURSAL(ID);
ALTER TABLE MOVIMIENTO_OPERATIVO ADD CONSTRAINT FOREIGN KEY (SUCURSAL_ID_DESTINO)    REFERENCES SUCURSAL(ID);
ALTER TABLE PRODUCTO_SUCURSAL ADD CONSTRAINT FOREIGN KEY (PRODUCTO_CODIGO_BARRAS)    REFERENCES PRODUCTO(CODIGO_BARRAS);
ALTER TABLE PRODUCTO_SUCURSAL ADD CONSTRAINT FOREIGN KEY (SUCURSAL_ID)    REFERENCES SUCURSAL(ID);
ALTER TABLE OFERTA_PRODUCTO ADD CONSTRAINT FOREIGN KEY (PRODUCTO_CODIGO_BARRAS)    REFERENCES PRODUCTO(CODIGO_BARRAS);
ALTER TABLE OFERTA_PRODUCTO ADD CONSTRAINT FOREIGN KEY (SUCURSAL_ID)    REFERENCES SUCURSAL(ID);
ALTER TABLE OFERTA_PRODUCTO ADD CONSTRAINT FOREIGN KEY (PROMOCION_ID)    REFERENCES PROMOCION(ID);
ALTER TABLE USUARIO_PERFIL ADD CONSTRAINT FOREIGN KEY (USUARIO_ID)    REFERENCES USUARIO(ID);
ALTER TABLE ENTRADA_SALIDA_DETALLE ADD CONSTRAINT FOREIGN KEY (ENTRADA_SALIDA_ID)    REFERENCES ENTRADA_SALIDA(ID);
ALTER TABLE ENTRADA_SALIDA_DETALLE ADD CONSTRAINT FOREIGN KEY (PRODUCTO_CODIGO_BARRAS)    REFERENCES PRODUCTO(CODIGO_BARRAS);
ALTER TABLE CORTE_CAJA ADD CONSTRAINT FOREIGN KEY (SUCURSAL_ID)    REFERENCES SUCURSAL(ID);
ALTER TABLE CORTE_CAJA ADD CONSTRAINT FOREIGN KEY (USUARIO_ID)    REFERENCES USUARIO(ID);
ALTER TABLE CORTE_CAJA ADD CONSTRAINT FOREIGN KEY (USUARIO_ID_AUTORIZO)    REFERENCES USUARIO(ID);
ALTER TABLE ENTRADA_SALIDA ADD CONSTRAINT FOREIGN KEY (ESTADO_ID_ACTUAL)    REFERENCES ESTADO(ID);
ALTER TABLE ENTRADA_SALIDA ADD CONSTRAINT FOREIGN KEY (CLIENTE_ID)    REFERENCES CLIENTE(ID);
ALTER TABLE ENTRADA_SALIDA ADD CONSTRAINT FOREIGN KEY (FORMA_DE_PAGO_ID)    REFERENCES FORMA_DE_PAGO(ID);
ALTER TABLE ENTRADA_SALIDA ADD CONSTRAINT FOREIGN KEY (METODO_DE_PAGO_ID)    REFERENCES METODO_DE_PAGO(ID);
ALTER TABLE ENTRADA_SALIDA ADD CONSTRAINT FOREIGN KEY (USUARIO_ID_CREO)    REFERENCES USUARIO(ID);
ALTER TABLE ENTRADA_SALIDA ADD CONSTRAINT FOREIGN KEY (USUARIOID)    REFERENCES USUARIO(ID);
ALTER TABLE CFD ADD CONSTRAINT FOREIGN KEY (CFD_ID_ORIGEN)    REFERENCES CFD(ID);
ALTER TABLE CFD ADD CONSTRAINT FOREIGN KEY (ENTRADA_SALIDA_ID)    REFERENCES ENTRADA_SALIDA(ID);
ALTER TABLE ENTRDA_SALIDA_ESTADO ADD CONSTRAINT FOREIGN KEY (ENTRADA_SALIDA_ID)    REFERENCES ENTRADA_SALIDA(ID);
ALTER TABLE ENTRDA_SALIDA_ESTADO ADD CONSTRAINT FOREIGN KEY (ESTADO_ID)    REFERENCES ESTADO(ID);
ALTER TABLE ENTRDA_SALIDA_ESTADO ADD CONSTRAINT FOREIGN KEY (USUARIO_ID)    REFERENCES USUARIO(ID);
